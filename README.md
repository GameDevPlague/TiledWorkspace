# Manopla地图编辑手册

> **写在前面：**该地图标准有大量不完善的地方，这个标准会在随时修改，所有人（无论归属于哪个组）都可以提出修改请求。我们会讨论后进行修改和追加，出于同样的原因，这个地图标准在设计时就包含了日后的追加修改等等。我们会尽量保持前向兼容，但是如果确实导致了未来不得不破坏兼容性，我们将会在这里注明并且标记为一个主要版本更新，所有的不会破坏兼容性的更新会为次要版本更新。
>
> 也就是说：`v1.2`标准写出来的地图在`v1.3`标准下是合法的地图，但是`v1.2`标准的地图在`v2.0`版本的标准下不是合法的地图。由于版本号只进不退，你无需考虑`v1.3`的地图是否在`v1.2`标准下合法。

## 当前版本：`v1.1`

## 地图场景设置

在Tiled里创建新地图的时候，请选择地图方向为正常，渲染方向为右下，图块层格式为CSV。关闭无穷地图。

地图的文件名非常重要，请遵循以下规则防止崩掉引擎。

- 游戏中无论文件结构，所有的文件名不可以重复。
- 文件名只可以使用小写字母和下划线和数字。
- 文件名的第一个字符不应该是下划线或者数字。
- 扩展名应始终为`.tmx`

地图大小没有特别的要求，但是请不要把它开到`50*50`以上，会引起严重的性能问题。

图块大小为`16*16`。

## 图块和层

你可以使用任意多的层。但是一个合法的场景至少应该包含以下三个层。

| Codename | 描述                                                         |
| -------- | ------------------------------------------------------------ |
| `Floor`  | 地板                                                         |
| `Wall`   | 墙，可以阻碍玩家的移动，该层的贴图会被用作墙的侧面。在当前的开发计划中，墙的顶面会被一个默认的占位贴图代替。 |
| `Object` | 物品层，用来放置各种物品，触发，标记等等。在Tiled中该层为一个对象层。 |

我们有添加其他层的计划：但是目前还是WIP状态，你可以自由使用以下的层，但是在目前的开发计划中，这些层并不会被解析并使用。可以自由的使用它们。

- `WallTop`：墙的顶面。这个层的每一个图块底下必须要有一个有效的Wall图块对应。
- (正在脑洞，欢迎提供点子…)

命名为其他名字的层不会被引擎理会。你可以善加利用这个特性，通过一些辅助层帮助自己排布场景中的物体。出于同样的原因，层的顺序无关紧要。

图块方面，请只使用工作空间提供的图块，如果要使用其他图块，请通过美术素材提交入口提交，它会被审核后同步进图块素材中。

## 对象层

目前我们支持两种对象，分别是点对象和矩形对象

点对象可以用来往场景中塞模型，处理传送点和触发点等等。

矩形对象可以用来制作空气墙，触发区域，传送等等。

如果不是仅模型，那么整个游戏中，所有对象的名字不可以重复。

如果使用点对象，那我们支持这些属性：

- `Tag`：应始终与对象的名字相同，字符串，可以在脚本中引用的点。
- `Mesh`：字符串。当设置时，引擎会去寻找有相同名字的模型，将其零点对齐放在这里。注意没有碰撞箱，碰撞箱需要你单独创建矩形碰撞箱。设计时注意，模型的零点总应当是模型的底部中点。

如果使用矩形对象，我们支持这些属性：

- `Collision`：Bool类型，设置为真时，它会有碰撞体积。
- `Tag`：应始终与对象的名字相同，字符串，可以在脚本中引用的点。
- `Teleport`：字符串，格式为`<Scenename>.<Tagname>`。不包含尖括号。如果设置了，当玩家进入时会被传送到对应的Tag上。如果是矩形对象，则会传送到正中央，如果是点对象，则只会传送到对应的位置。

在撰写的时候，我认为游戏的逻辑不应该展现在地图中，它应该是脚本中展现的。所以刻意保持了极端简单的地图数据。我们之后可能会按找需求增添新的属性，请不吝惜你们的宝贵建议。